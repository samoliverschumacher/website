<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Autonomous vechicle microsleep detector Vol1: EDA - Sam Schumacher</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Autonomous vechicle microsleep detector Vol1: EDA" />
<meta property="og:description" content="Produce a detector that distinguisihes when a car&rsquo;s driver has eyes closed. This detector will connect to an autopilot system for the car temporarily until driver regains control, otherwise safely brings the car to a halt on the side of the road. Detector will have access to EEG signals connected to drivers head." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/eeg_eda/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-12-18T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2020-12-18T00:00:00&#43;00:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="../../css/style.css">
	

	<link rel="shortcut icon" href="../../favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo logo--mixed">
		<a class="logo__link" href="../../" title="Sam Schumacher" rel="home">
			<div class="logo__item logo__imagebox">
					<img class="logo__img" src="../../images/matlabart_neuronevolution.png">
				</div><div class="logo__item logo__text">
					<div class="logo__title">Sam Schumacher</div>
					<div class="logo__tagline">ML &amp; AI</div>
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="../../about/">
				
				<span class="menu__text">this blog</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Autonomous vechicle microsleep detector Vol1: EDA</h1>
			<p class="post__lead">Binary classification using EEG readings (part 1 of 3)</p>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class="meta__text" datetime="2020-12-18T00:00:00Z">December 18, 2020</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg><span class="meta__text"><a class="meta__link" href="../../categories/machine-learning/" rel="category">Machine Learning</a>, <a class="meta__link" href="../../categories/datascience/" rel="category">Datascience</a>
	</span>
</div></div>
		</header>
		<figure class="post__thumbnail">
			<img src="../../images/eegvis_landscapeB.png/" alt="Autonomous vechicle microsleep detector Vol1: EDA">
		</figure><div class="content post__content clearfix">
			<p><em>Produce a detector that distinguisihes when a car&rsquo;s driver has eyes closed. This detector will connect to an autopilot system for the car temporarily until driver regains control, otherwise safely brings the car to a halt on the side of the road. Detector will have access to EEG signals connected to drivers head.</em></p>
<hr>
<blockquote>
<p>This is the first in a 3 part project that shows how brain waves can be used to predict if a persons eyes are closed. The mock-bussiness problem is that of a car&rsquo;s partial autopilot system. Part 1 is this Exploratory data analysis, <a href="../../post/eeg_modelling/" title="Modelling">Part 2</a> is the feature engineering and model creation, <a href="../../post/eeg_costtradeoff/" title="Cost Tradeoff">Part 3</a> explores  the process of re-weighting an accuracy metric, to favour correctly predicting when the eyes are closed.</p>
</blockquote>
<hr>
<h3 id="table-of-contents">Table of Contents</h3>
<ul>
<li><a href="#the-business-problem">The Business Problem</a></li>
<li><a href="#static-dataset-analysis">Static Dataset analysis</a></li>
<li><a href="#temporal-patterns">Temporal Patterns</a>
<ul>
<li><a href="#removing-blinking-from-the-closed-eyes-class">Removing blinking from the Closed-eyes class</a></li>
<li><a href="#windowed-eeg-correlations">Windowed EEG correlations</a></li>
<li><a href="#moving-window-of-eeg-correlations">Moving window of EEG correlations</a></li>
</ul>
</li>
<li><a href="#eda-summary">EDA Summary</a></li>
</ul>
<h1 id="the-business-problem">The Business Problem</h1>
<p>The dataset for training the model, described <a href="https://github.com/datasets/eeg-eye-state/">from the source</a>;</p>
<blockquote>
<p><em>&ldquo;All data is from one continuous EEG measurement with the Emotiv EEG Neuroheadset. The duration of the measurement was 117 seconds. The eye state was detected via a camera during the EEG measurement and added later manually to the file after analysing the video frames. &lsquo;1&rsquo; indicates the eye-closed and &lsquo;0&rsquo; the eye-open state. All values are in chronological order with the first measured value at the top of the data.&quot;</em></p>
</blockquote>
<p>Critical to any data science project, is understanding the data. This is best done by exploring the application context, and reading between the lines of the envisioned use case. Some assumptions can be implied from the problem statement;</p>
<ol>
<li>Detector must work on-line; makes predictions only with the sequence of data points leading up to prediction timestep.</li>
<li>A car autopilot that turns on when it&rsquo;s not supposed to, isn&rsquo;t nearly as bad as one that doesn&rsquo;t turn on when it&rsquo;s supposed to.</li>
<li>Not all &ldquo;eyes closed&rdquo; are equal - blinking should not trigger the autopilot system.</li>
<li>Temporal consistency in autopilot state (on or off) is important to usability. Like a flickering light, avoiding an autopilot that switches on &amp; off is critical for the final product usability.</li>
</ol>
<p>Before trying models to predict the eye state, we will explore the datasets' shapes, patterns &amp; anomalies in order to develop some hypotheses about which modelling technique is well suited.</p>
<p>While the dataset at first glance is time series, we will refrain from making any assumptions about how best to treat it, until it is understood. exploration will be from two perspectives;</p>
<ul>
<li>Distributions of values &amp; correlations between variables, as if it were a static dataset.</li>
<li>Temporality. Including wave patterns &amp; temporal relationships etc.</li>
</ul>
<h1 id="static-dataset-analysis">Static Dataset analysis</h1>
<p>Variables 1 - 14 are the voltage recorded by the EEG at different points on the subjects brain, and the 15th is the eye state detected via a camera.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-matlab" data-lang="matlab">load(<span style="color:#e6db74">&#39;EEGrawData.mat&#39;</span>);
<span style="color:#75715e">% View data type, min, max and median of each of the raw data columns</span>
summary(rawData)
</code></pre></div><pre><code>Variables:
    EEG_1: 14980×1 double
        Values:
            Min           1030.8
            Median        4294.4
            Max       3.0923e+05
    EEG_2: 14980×1 double
        Values:
            Min       2830.8 
            Median    4005.6 
            Max       7804.6 
    EEG_3: 14980×1 double
        Values:
            Min         1040 
            Median    4262.6 
            Max       6880.5 
    EEG_4: 14980×1 double
        Values:
            Min           2453.3
            Median        4120.5
            Max       6.4256e+05
    EEG_5: 14980×1 double
        Values:
            Min       2089.7 
            Median      4339 
            Max       6474.4 
    EEG_6: 14980×1 double
        Values:
            Min           2768.2
            Median        4617.9
            Max       3.6256e+05
    EEG_7: 14980×1 double
        Values:
            Min           2086.2
            Median        4070.3
            Max       5.6718e+05
    EEG_8: 14980×1 double
        Values:
            Min       4567.2 
            Median    4613.3 
            Max       7264.1 
    EEG_9: 14980×1 double
        Values:
            Min             1358
            Median        4199.5
            Max       2.6564e+05
    EEG_10: 14980×1 double
        Values:
            Min        1816.4 
            Median     4229.2 
            Max        6674.4 
    EEG_11: 14980×1 double
        Values:
            Min        3273.3 
            Median     4200.5 
            Max        6823.1 
    EEG_12: 14980×1 double
        Values:
            Min        2257.9 
            Median     4276.9 
            Max        7002.6 
    EEG_13: 14980×1 double
        Values:
            Min           86.667
            Median        4603.1
            Max       1.5231e+05
    EEG_14: 14980×1 double
        Values:
            Min          1366.2
            Median       4354.9
            Max       7.159e+05
    Eyestate: 14980×1 double
        Values:
            Min           0     
            Median        0     
            Max           1     
</code></pre><p>Median voltage values are around 4300, minimums and maximums are roughly the same, except a few observations that are two orders of magnitude higher (or lower). These can be removed by replacing values outside the upper and lower 0.1% quantile with their nearest value in time.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-matlab" data-lang="matlab">N = height(rawData); <span style="color:#75715e">% number of observations</span>
N_seconds = <span style="color:#ae81ff">117</span>; <span style="color:#75715e">% approx length of timeseries in seconds</span>
idx_openclose = rawData{:,<span style="color:#e6db74">&#39;Eyestate&#39;</span>};
eegName= erase( string(strcat(<span style="color:#e6db74">&#39;EEG&#39;</span>,num2str([<span style="color:#ae81ff">1</span>:Nvars]<span style="color:#f92672">&#39;</span>) ) )<span style="color:#f92672">&#39;</span>,<span style="color:#e6db74">&#39; &#39;</span>);
allqntls = quantile(rawData{:,<span style="color:#ae81ff">1</span>:Nvars},[<span style="color:#ae81ff">0.001</span>, <span style="color:#ae81ff">0.999</span>]);
TimeSeries_cln = rawData{:,<span style="color:#ae81ff">1</span>:Nvars};
<span style="color:#75715e">% top and bottom 0.1% of each EEG is removed as an outlier.</span>
TimeSeries_cln( TimeSeries_cln<span style="color:#f92672">&gt;</span>= allqntls(<span style="color:#ae81ff">2</span>,:) <span style="color:#f92672">|</span> TimeSeries_cln<span style="color:#f92672">&lt;</span>= allqntls(<span style="color:#ae81ff">1</span>,:) ) =NaN;
TimeSeries_cln = fillmissing(TimeSeries_cln,<span style="color:#e6db74">&#39;nearest&#39;</span>);
figure(<span style="color:#e6db74">&#39;Position&#39;</span>,[<span style="color:#ae81ff">30</span>	<span style="color:#ae81ff">629</span>	<span style="color:#ae81ff">1746</span>	<span style="color:#ae81ff">312</span>]); 
<span style="color:#66d9ef">for</span> fi = <span style="color:#ae81ff">1</span>:Nvars
    histogram( TimeSeries_cln(:,fi) ,linspace(min(allqntls(:)),max(allqntls(:)),<span style="color:#ae81ff">240</span>),<span style="color:#e6db74">&#39;EdgeColor&#39;</span>,<span style="color:#e6db74">&#39;none&#39;</span>); hold on;
<span style="color:#66d9ef">end</span>
title(<span style="color:#e6db74">&#39;EEG signals within 99.9% of all observed values&#39;</span>); xlabel(<span style="color:#e6db74">&#39;mV&#39;</span>);
</code></pre></div><p><img src="../../images/eegeda/1.png" alt="multi"></p>
<p>Each of the EEGs have a slightly different range of values, but this will be irrelevant as long as each EEG is standardised before feeding into a model, or, if the model treats each of them as a unique dimension. There appears to be some histograms with different skew which will be easiest viewed with a boxplot, after normalising the outlier-free data.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-matlab" data-lang="matlab">TimeSeries_clnnorm = normalize( TimeSeries_cln );
figure(<span style="color:#e6db74">&#39;Position&#39;</span>,[<span style="color:#ae81ff">141</span>,<span style="color:#ae81ff">224</span>,<span style="color:#ae81ff">1586</span>,<span style="color:#ae81ff">717</span>]);
<span style="color:#75715e">% Set Outliers to display if they are outside 3 std. deviations</span>
boxplot( TimeSeries_clnnorm ,<span style="color:#e6db74">&#39;Orientation&#39;</span>, <span style="color:#e6db74">&#39;horizontal&#39;</span>,<span style="color:#e6db74">&#39;Symbol&#39;</span>,<span style="color:#e6db74">&#39;ro&#39;</span>,<span style="color:#e6db74">&#39;Jitter&#39;</span>,<span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#39;Whisker&#39;</span>,<span style="color:#ae81ff">3</span>);
yticklabels(eegName); grid on;
xlim([<span style="color:#f92672">-</span><span style="color:#ae81ff">8</span> , <span style="color:#ae81ff">8</span>]); xlabel(<span style="color:#e6db74">&#39;normalised mV&#39;</span>)
title(<span style="color:#e6db74">&#39;EEG signals within 99.9% of all observed values&#39;</span>)
</code></pre></div><p><img src="../../images/eegeda/7.png/" alt="eeg box plot"></p>
<p>The boxplot whisker length is set to 3 times the interquartile range. Seeing more outliers across all variables' box-plots to the right, means the distribution will have heavy tails (compared to a normal distribution) i.e. more very large values than very small values. The prediction model must be capable of handling asymmetric extreme values.</p>
<blockquote>
<p><strong>Insight #1</strong>: <em>&ldquo;EEG values' extremes are asymmetric around their medians&rdquo;</em></p>
</blockquote>
<p>Whats not clear, is whether during eyes closed, the EEG variables differ to the open state, (regardless of which timestep). So the question is;</p>
<p><em>Can the data be treated as independent observations, rather than as time-series, for the purpose of classifying the state of the eye?</em></p>
<p>If the data were strictly time-invariant, EEG values could predict the eye state regardless of what the eye-state was before or after an observation. A histogram of EEG values comparing eye states should give a hint if this is happening.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-matlab" data-lang="matlab"><span style="color:#75715e">% Standardise values to have zero mean</span>
figure(<span style="color:#e6db74">&#39;Position&#39;</span>,[<span style="color:#ae81ff">141</span>,<span style="color:#ae81ff">224</span>,<span style="color:#ae81ff">1586</span>,<span style="color:#ae81ff">717</span>]);
<span style="color:#66d9ef">for</span> v=<span style="color:#ae81ff">1</span>:Nvars
    subplot(<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">3</span>,v)
    histogram(TimeSeries_clnnorm(idx_openclose<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>,v),<span style="color:#e6db74">&#39;Normalization&#39;</span>,<span style="color:#e6db74">&#39;pdf&#39;</span>); hold on;
    histogram(TimeSeries_clnnorm(idx_openclose<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>,v),<span style="color:#e6db74">&#39;Normalization&#39;</span>,<span style="color:#e6db74">&#39;pdf&#39;</span>,<span style="color:#e6db74">&#39;EdgeColor&#39;</span>,<span style="color:#e6db74">&#39;none&#39;</span>); 
    title(eegName(v)); legend({<span style="color:#e6db74">&#39;Closed&#39;</span>,<span style="color:#e6db74">&#39;Open&#39;</span>}); xlabel(<span style="color:#e6db74">&#39;Normalised mV&#39;</span>)
    xlim([<span style="color:#f92672">-</span><span style="color:#ae81ff">8</span> , <span style="color:#ae81ff">8</span>]);
<span style="color:#66d9ef">end</span>
</code></pre></div><p><img src="../../images/eegeda/6.png/" alt="eeg histograms"></p>
<p>Globally, it&rsquo;s not obvious that magnitude of EEG values is different for each eye-state.</p>
<blockquote>
<p><strong>Insight #2</strong>: <em>&ldquo;Mean EEG value doesn&rsquo;t change much globally with eye state&rdquo;</em></p>
</blockquote>
<h1 id="temporal-patterns">Temporal Patterns</h1>
<p>Next, is to put the assumption that the dataset is stationary on hold, and inspect the temporality of the data. Visualising the time-based interdependencies of EEG variables might be hard as there are quite a few. Though overlaying eye-state could help to reveal obvious patterns.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-matlab" data-lang="matlab"><span style="color:#75715e">% View data as time series</span>
figure(<span style="color:#e6db74">&#39;Position&#39;</span>,[<span style="color:#ae81ff">141</span>,<span style="color:#ae81ff">224</span>,<span style="color:#ae81ff">1586</span>,<span style="color:#ae81ff">717</span>]);
<span style="color:#66d9ef">for</span> v=<span style="color:#ae81ff">1</span>:Nvars
    subplot(<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">3</span>,v)
    plot(TimeSeries_cln(:,v)); ylabel(<span style="color:#e6db74">&#39;mV&#39;</span>)
    yyaxis right; bar(idx_openclose,<span style="color:#e6db74">&#39;LineStyle&#39;</span>,<span style="color:#e6db74">&#39;none&#39;</span>,<span style="color:#e6db74">&#39;FaceAlpha&#39;</span>,<span style="color:#ae81ff">0.2</span>); ylabel(<span style="color:#e6db74">&#39;Closed = 1&#39;</span>)
    xlabel(<span style="color:#e6db74">&#39;time (128^t^h sec)&#39;</span>);
    title(eegName(v))
<span style="color:#66d9ef">end</span>
</code></pre></div><p><img src="../../images/eegeda/timeseries1.png/" alt="eeg time series 1"></p>
<p>Plotted as a time series it&rsquo;s clear that for some EEGs, the signal &lsquo;spikes&rsquo; as the patients' eyes open or close. It&rsquo;s hard to make out on the small plots. Zooming in on transition from open to closed eyes in the range t= 2000 - 3500;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-matlab" data-lang="matlab"><span style="color:#66d9ef">for</span> v=<span style="color:#ae81ff">1</span>:Nvars
    xlim(subplot(<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">3</span>,v),[<span style="color:#ae81ff">2000</span> , <span style="color:#ae81ff">3500</span>])
<span style="color:#66d9ef">end</span>
</code></pre></div><p><img src="../../images/eegeda/5.png/" alt="eeg time series zoom"></p>
<p>The patterns happen before opening &amp; closing, including a brief blink around t = 2800. So, the pattern is more specific for regular closing, compared to blinking only.</p>
<p>The effect is more pronounced in EEGs 1-2 &amp; 11-14 across the whole dataset.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-matlab" data-lang="matlab"><span style="color:#75715e">% View particular Variables only, as time series.</span>
figure(<span style="color:#e6db74">&#39;Position&#39;</span>,[<span style="color:#ae81ff">141</span>,<span style="color:#ae81ff">224</span>,<span style="color:#ae81ff">1586</span>,<span style="color:#ae81ff">717</span>]);
vars=[<span style="color:#ae81ff">1</span>:<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">11</span>:<span style="color:#ae81ff">14</span>];
<span style="color:#66d9ef">for</span> v=vars
    subplot(<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">2</span>,find(vars<span style="color:#f92672">==</span>v))
    yyaxis left; plot(TimeSeries_cln(:,v)); ylabel(<span style="color:#e6db74">&#39;mV&#39;</span>)
    yyaxis right; bar(idx_openclose,<span style="color:#e6db74">&#39;LineStyle&#39;</span>,<span style="color:#e6db74">&#39;none&#39;</span>,<span style="color:#e6db74">&#39;FaceAlpha&#39;</span>,<span style="color:#ae81ff">0.2</span>); ylabel(<span style="color:#e6db74">&#39;Closed = 1&#39;</span>)
    xlabel(<span style="color:#e6db74">&#39;time \fontsize{8}({\it128^t^h sec})&#39;</span>);
    title(eegName(v))
<span style="color:#66d9ef">end</span>
</code></pre></div><p><img src="../../images/eegeda/4.png/" alt="eeg transition signals"></p>
<blockquote>
<p><strong>Insight #3</strong>: <em>&ldquo;Lead signals exist for closing &amp; opening eys. Strongest in EEGs 1-2 &amp; 11-14&rdquo;</em></p>
</blockquote>
<p>It&rsquo;s worth noting that the temporal shape and magnitude of the spikes differ across time, for all variables. Transition signals begin at different values also.</p>
<blockquote>
<p><strong>Insight #4</strong>: <em>&ldquo;Shape of Lead signal is independent of starting magnitude&rdquo;</em></p>
</blockquote>
<p>There is also an anomalous pattern that occurs only twice in the series, prior to the last time the subject closes eyes @ t ~ 11,000. It looks like the rest of the eye-state transition patterns, but occurs earlier, &amp; is more dragged out. It&rsquo;s also relatively stronger in EEGs which normally don&rsquo;t have obvious spikes that signal an eye-state transition.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-matlab" data-lang="matlab">figure(<span style="color:#e6db74">&#39;Position&#39;</span>,[<span style="color:#ae81ff">141</span>,<span style="color:#ae81ff">224</span>,<span style="color:#ae81ff">1586</span>,<span style="color:#ae81ff">717</span>]);
vars=[<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">13</span>];
<span style="color:#66d9ef">for</span> v=vars
    subplot(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>,find(vars<span style="color:#f92672">==</span>v))
    yyaxis left; plot(TimeSeries_cln(:,v)); ylabel(<span style="color:#e6db74">&#39;mV&#39;</span>)
    xlabel(<span style="color:#e6db74">&#39;time \fontsize{8}({\it128^t^h sec})&#39;</span>);    title(eegName(v))
    annotation_datadims(<span style="color:#e6db74">&#39;rectangle&#39;</span>,[<span style="color:#ae81ff">10000</span>, min(ylim), <span style="color:#ae81ff">1500</span>,diff(ylim)] ,<span style="color:#e6db74">&#39;FaceAlpha&#39;</span>,<span style="color:#ae81ff">0.2</span>,<span style="color:#e6db74">&#39;FaceColor&#39;</span>,<span style="color:#e6db74">&#39;g&#39;</span>);
    yyaxis right; bar(idx_openclose,<span style="color:#e6db74">&#39;LineStyle&#39;</span>,<span style="color:#e6db74">&#39;none&#39;</span>,<span style="color:#e6db74">&#39;FaceAlpha&#39;</span>,<span style="color:#ae81ff">0.2</span>); ylabel(<span style="color:#e6db74">&#39;Closed = 1&#39;</span>)
<span style="color:#66d9ef">end</span>
</code></pre></div><p><img src="../../images/eegeda/3.png/" alt="eeg time series"></p>
<p>EEG1 has a spike around t=11,000 not too different to other spikes near eye-state changes. Though in EEG8, this spike @t=11,000 is found also, and much larger compared to the other spikes in EEG8.</p>
<blockquote>
<p><strong>Insight #5</strong>: <em>&ldquo;Similar patterns to transition-spikes in EEGs 1-2, 11-14 occur at some non-transition timesteps, but EEGs 5 &amp; 8 have a uniquely pronounced signal at this time also&rdquo;</em></p>
</blockquote>
<p>The EEGs without pronounced spikes around eye-state transitions could be critical to predicting the transitions, because they have pronounced spikes only during the anomalous patterns after t=11,000 which could be used by a model to nullify the normal (false) transition-spike detection.</p>
<h2 id="removing-blinking-from-the-closed-eyes-class">Removing blinking from the Closed-eyes class</h2>
<p>As the machine learning application is to detect microsleep in a driver, blinking should not classify as being asleep (in a microsleep). <a href="https://iovs.arvojournals.org/article.aspx?articleid=2188061">A quick google search</a> of blinking shows microsleeps occur with duration 500 miliseconds. So for this analysis, closed eye sequences of less than 0.45 seconds will be converted to the open eye class.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-matlab" data-lang="matlab"><span style="color:#75715e">% remove &#39;eyes blinking&#39; from the dataset: closed eyes for under 1 second only</span>
blinkduration_seconds = <span style="color:#ae81ff">0.45</span>;
blinkduration_tsteps = N<span style="color:#f92672">*</span>(blinkduration_seconds<span style="color:#f92672">/</span>N_seconds);
idx_blink = movsum( idx_openclose ,[blinkduration_tsteps blinkduration_tsteps])<span style="color:#f92672">&lt;</span>blinkduration_tsteps <span style="color:#f92672">&amp;</span> idx_openclose;
idx_openclose = <span style="color:#f92672">~</span>idx_blink <span style="color:#f92672">&amp;</span> idx_openclose;
</code></pre></div><h2 id="windowed-eeg-correlations">Windowed EEG correlations</h2>
<p>Perhaps the degree of correlation between EEGs changes with eye state. i.e. do EEG values &ldquo;move together&rdquo; more in one eye state vs the other? The covariance matrix needs to be calculated with observations during open eyes, and again with closed eyes. The difference between the two matrices will be non-zero if EEG correlations are in some way dependent on eye state.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-matlab" data-lang="matlab"><span style="color:#75715e">% Correlation difference between open eye-state and closed eye-state</span>
corr_delta = corr(TimeSeries_clnnorm(idx_openclose<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>,:)) <span style="color:#f92672">-</span> corr(TimeSeries_clnnorm(idx_openclose<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>,:));
<span style="color:#75715e">% get values in the lowest and highest 5% quantiles</span>
cor_10 = quantile(corr_delta(:),[<span style="color:#ae81ff">0.05</span> <span style="color:#ae81ff">0.95</span>]);
corr_10_idx = triu(ones(<span style="color:#ae81ff">14</span>),<span style="color:#ae81ff">1</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">&amp;</span> (corr_delta<span style="color:#f92672">&gt;</span>cor_10(<span style="color:#ae81ff">2</span>) <span style="color:#f92672">|</span> corr_delta<span style="color:#f92672">&lt;</span>cor_10(<span style="color:#ae81ff">1</span>));
[rw,cl] = find(corr_10_idx);
EEGcorr = array2table(corr_delta,<span style="color:#e6db74">&#39;RowNames&#39;</span>,cellstr(eegName)<span style="color:#f92672">&#39;</span>,<span style="color:#e6db74">&#39;VariableNames&#39;</span>,cellstr(eegName));
disp(EEGcorr(unique(rw),unique(cl)))
               EEG2         EEG5       EEG6       EEG13        EEG14  
            __________    ________    _______    ________    _________
    EEG1      <span style="color:#f92672">-</span><span style="color:#ae81ff">0.18467</span>     <span style="color:#ae81ff">0.15676</span>    <span style="color:#ae81ff">0.17309</span>    <span style="color:#f92672">-</span><span style="color:#ae81ff">0.14417</span>    <span style="color:#f92672">-</span><span style="color:#ae81ff">0.041972</span>
    EEG2             <span style="color:#ae81ff">0</span>    <span style="color:#ae81ff">0.088926</span>    <span style="color:#ae81ff">0.20876</span>    <span style="color:#f92672">-</span><span style="color:#ae81ff">0.24237</span>      <span style="color:#f92672">-</span><span style="color:#ae81ff">0.2593</span>
    EEG3      <span style="color:#ae81ff">0.070592</span>     <span style="color:#ae81ff">0.13336</span>    <span style="color:#ae81ff">0.13232</span>    <span style="color:#f92672">-</span><span style="color:#ae81ff">0.21959</span>    <span style="color:#f92672">-</span><span style="color:#ae81ff">0.083616</span>
    EEG4    <span style="color:#f92672">-</span><span style="color:#ae81ff">0.0015357</span>    <span style="color:#ae81ff">0.059228</span>    <span style="color:#ae81ff">0.16603</span>    <span style="color:#f92672">-</span><span style="color:#ae81ff">0.22099</span>     <span style="color:#f92672">-</span><span style="color:#ae81ff">0.13115</span>
    EEG7     <span style="color:#f92672">-</span><span style="color:#ae81ff">0.037652</span>    <span style="color:#ae81ff">0.023117</span>    <span style="color:#ae81ff">0.12199</span>     <span style="color:#ae81ff">0.11297</span>      <span style="color:#ae81ff">0.18187</span>
</code></pre></div><p>Of the 14 x 14 EEG Covariance matrix, the most extreme differences in correlations between open and closed eye states are around 0.1 - 0.25. For example, EEG1 is 0.178 less correlated with EEG2, when the eyes are open.</p>
<p>This is promising, but still far from useful as the business problem requires an online detection algorithm. these covariance matrix pertubations need to be occuring on a local time-scale, not just across the entire dataset.</p>
<h2 id="moving-window-of-eeg-correlations">Moving window of EEG correlations</h2>
<p>To check if this insight is going to be practical, the effect must occur on a small time window. For example, <em>&ldquo;the cars autopilot should activate with a delay no longer than 1 second&rdquo;</em> could be an upper bound on the final product&rsquo;s design.</p>
<p>Dividing the 117 second sequence randmoly, into buckets of roughly 0.5 seconds in length, and then checking whether the covarianve matrices differ between eye states on this smaller timescale;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-matlab" data-lang="matlab"><span style="color:#75715e">% partition the data into 200 buckets, while maintaining class balance in each bucket (open-close eyes)</span>
CV = cvpartition(idx_openclose,<span style="color:#e6db74">&#39;KFold&#39;</span>,<span style="color:#ae81ff">200</span> );
disp(CV)
</code></pre></div><pre><code>K-fold cross validation partition
   NumObservations: 14980
       NumTestSets: 200
     TrainSize: 14906  14905  14905  14905  14905  14905  14905  14905  14905  14905 ...
      TestSize: 74  75  75  75  75  75  75  75  75  75 ...
</code></pre><p>Each bucket is 75 timesteps, and should have the same balance between open and closed state observations. Now we have the differences in correlation matricies, for each of the 200 buckets.</p>
<p>There will be 91 correlations between variables (14 variables, less correlations between themselves). Each of the 200 buckets will have 91 values showing the change in correlations between EEGs due to the eye state.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-matlab" data-lang="matlab"><span style="color:#75715e">% loop over each of the 200 samples, and store the covariance matrix of</span>
<span style="color:#75715e">% EEGs for both Open and Closed eye states.</span>
Xcorrdiff = NaN(<span style="color:#ae81ff">200</span> ,((Nvars^<span style="color:#ae81ff">2</span>)<span style="color:#f92672">-</span>Nvars)<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span> ); 
<span style="color:#66d9ef">for</span> ci = <span style="color:#ae81ff">1</span>:<span style="color:#ae81ff">200</span>
    <span style="color:#75715e">% correlations between EEGs for the current bucket of random observations</span>
    XClosed = corr(TimeSeries_clnnorm(CV.test(ci) <span style="color:#f92672">&amp;</span> idx_openclose<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>,:)); 
    XOpen = corr(TimeSeries_clnnorm(CV.test(ci) <span style="color:#f92672">&amp;</span> idx_openclose<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>,:));
    <span style="color:#75715e">% vectorise the upper right triangle of the correlation matrix.</span>
    XClosed = XClosed( triu(ones(<span style="color:#ae81ff">14</span>),<span style="color:#ae81ff">1</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span> );
    XOpen = XOpen( triu(ones(<span style="color:#ae81ff">14</span>),<span style="color:#ae81ff">1</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span> );
    <span style="color:#75715e">% store the differences between corelation vectors</span>
    Xcorrdiff(ci,:) = diff([XOpen,XClosed],<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>);
<span style="color:#66d9ef">end</span>
<span style="color:#75715e">% calculate significance tests on each corelation vector element, to see if open and closed states has an effect with 99% confidence.</span>
significant_delta = arrayfun(@(x) ttest(Xcorrdiff(:,x),<span style="color:#ae81ff">0</span>,<span style="color:#e6db74">&#39;Alpha&#39;</span>, <span style="color:#ae81ff">0.01</span>) , <span style="color:#ae81ff">1</span>:size(Xcorrdiff,<span style="color:#ae81ff">2</span>) );
figure(<span style="color:#e6db74">&#39;Position&#39;</span>,[<span style="color:#ae81ff">141</span>,<span style="color:#ae81ff">224</span>,<span style="color:#ae81ff">1586</span>,<span style="color:#ae81ff">717</span>]); 
boxplot((Xcorrdiff));
<span style="color:#75715e">% remove the correlations which do not significantly differ between open and closed eyes, across the 200 samples.</span>
Xcorrdiff_significant = Xcorrdiff;
Xcorrdiff_significant(:,significant_delta<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>)=NaN;
[rw,cl] = find(triu(ones(<span style="color:#ae81ff">14</span>),<span style="color:#ae81ff">1</span>)<span style="color:#f92672">==</span><span style="color:#ae81ff">1</span>);
corrlabels= erase( string(strcat(num2str(rw),<span style="color:#e6db74">&#39;_&#39;</span>,num2str(cl) ) )<span style="color:#f92672">&#39;</span>,<span style="color:#e6db74">&#39; &#39;</span>);
corrlabels( significant_delta<span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>)=<span style="color:#e6db74">&#39;&#39;</span>;
hold on; boxplot((Xcorrdiff_significant),<span style="color:#e6db74">&#39;PlotStyle&#39;</span>,<span style="color:#e6db74">&#39;Compact&#39;</span>,<span style="color:#e6db74">&#39;Labels&#39;</span>,corrlabels); set(gca,<span style="color:#e6db74">&#39;XTickLabelRotation&#39;</span>,<span style="color:#ae81ff">90</span>)
grid on; xlabel(<span style="color:#e6db74">&#39;EEG correlations&#39;</span>); ylabel(<span style="color:#e6db74">&#39;Change in correlation due to eye state&#39;</span>);
title(<span style="color:#e6db74">&#39;Distributions of in EEG correlation differences due to eye state, across the 200 samples&#39;</span>)
</code></pre></div><p><img src="../../images/eegeda/2.png/" alt="EEGc correlation differences distribution"></p>
<p>The box plot shows how the 91 correlation changes are distributed over the 200 randomly picked buckets.</p>
<p>Highlighted are the correlations which change due to eye state, with 99% confidence (against the zero mean normal assumption). For example, the left most box and whisker plot is shows the 200 samples are distributed above zero, with all but a few outliers. It shows EEGs 1 &amp; 2 are more stronbgly correlated when eyes are open. And EEG 1 &amp; 8, are less correlated when eyes are open, though the effect ismore variaed across the 200 buckets (by the longer box, compared to EEG1-2).</p>
<blockquote>
<p><strong>Insight #6</strong>: <em>&ldquo;Some EEG correlations shift significatnly depending on eye state.&quot;</em></p>
</blockquote>
<h1 id="eda-summary">EDA Summary</h1>
<p>Through inspecting the dataset, we&rsquo;ve seen both visually and with some statistics, how a model might best split the two classes using the 14 EEGs. In summary;</p>
<p><strong>Insights found in the dataset;</strong></p>
<ol>
<li><strong>EEG values' extremes are asymmetric around their medians.</strong></li>
<li><strong>Mean EEG value doesn&rsquo;t change much globally with eye state.</strong></li>
<li><strong>Lead signals exist for eyes opening &amp; eyes 4. closing. Strongest in variables 1-2 &amp; 11-14.</strong></li>
<li><strong>&lsquo;Shape&rsquo; of Lead signal is independent of starting magnitude.</strong></li>
<li><strong>False transition signals are indicated by anomalies in EEGs 5 &amp; 8.</strong></li>
<li><strong>Some EEG correlations shift significatnly depending on eye state.</strong></li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-matlab" data-lang="matlab">save(<span style="color:#e6db74">&#39;EEGloseEyes_EDA.mat&#39;</span>)
</code></pre></div><hr>
<p>In this Exploratory Data Analysis, we&rsquo;ve established a foundation of knowledge about the data &amp; the probelm. Now the <a href="../../post/eeg_modelling/" title="Modelling">model selection process</a> can start.</p>
<hr>
		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="../../tags/timeseries/" rel="tag">timeseries</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="../../tags/data-visualisation/" rel="tag">data visualisation</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="../../tags/statistics/" rel="tag">statistics</a>
		</li>
		<li class="tags__item">
			<a class="tags__link btn" href="../../tags/exploratory-data-analysis/" rel="tag">exploratory data analysis</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="Sam Schumacher avatar" src="../../images/matlabart_neuronevolution2.png/" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">About Sam Schumacher</span>
	</div>
	<div class="authorbox__description">
		Using machine learning projects to discover the world through its problems
	</div>
</div>

<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="../../post/buildingnnet/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">A DIY reccurent neural network algorithm</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="../../post/eeg_modelling/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Autonomous vechicle microsleep detector Vol2: Modelling</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2021 Sam Schumacher.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>

<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
	</div>
<script async defer src="../../js/menu.js"></script>

<script 
src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async>
</script>
</body>
</html>